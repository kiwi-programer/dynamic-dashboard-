{% extends "base.html" %}

{% block content %}
<section class="panel">
    <h2>Schoology API Setup</h2>
    {% if message %}<p class="ok">{{ message }}</p>{% endif %}
    {% if error %}<p class="err">{{ error }}</p>{% endif %}
    <form class="form-grid" method="post" action="/schoology/settings">
        <label>Domain (e.g. app.schoology.com)
            <input name="domain" value="{{ settings.schoology_domain }}">
        </label>
        <label>API Key<input name="key" value="{{ settings.schoology_key }}"></label>
        <label>API Secret<input name="secret" value="{{ settings.schoology_secret }}"></label>
        <label>Access Token (optional)<input name="token" value="{{ settings.schoology_token }}"></label>
        <label>Access Token Secret (optional)<input name="token_secret" value="{{ settings.schoology_token_secret }}"></label>
        <label>Section/Course ID<input name="section_id" value="{{ settings.schoology_section_id }}"></label>
        <button type="submit">Save & Refresh</button>
    </form>
</section>

<section class="panel">
    <h2>Current Grade</h2>
    {% if grades.current_score or grades.current_grade %}
        <p><strong>Score:</strong> {{ grades.current_score or 'N/A' }}</p>
        <p><strong>Letter:</strong> {{ grades.current_grade or 'N/A' }}</p>
    {% else %}
        <p class="muted">Connect Schoology and set Section ID to load grades.</p>
    {% endif %}
</section>

<section class="panel">
    <h2>Assignment Grade Impact</h2>
    <form id="impact-form" class="form-grid">
        <label>Current points earned<input id="points-earned" type="number" step="0.01" min="0" required></label>
        <label>Current points possible<input id="points-possible" type="number" step="0.01" min="0.01" required></label>
        <label>Assignment possible points<input id="assignment-points" type="number" step="0.01" min="0.01" required></label>
        <label>Expected score<input id="expected-score" type="number" step="0.01" min="0" required></label>
        <button type="button" id="calc-impact">Calculate</button>
    </form>
    <p id="impact-result" class="muted">Enter values to estimate new percentage.</p>
</section>

<section class="panel">
    <h2>Assignments</h2>
    {% if assignments %}
        <ul class="item-list">
            {% for assignment in assignments %}
                <li class="item-row stacked">
                    <div>
                        <strong>{{ assignment.title }}</strong>
                        <small>Due: {{ assignment.due }} | Max points: {{ assignment.max_points }}</small>
                    </div>
                    <p>{{ assignment.description|safe }}</p>
                    {% if assignment.web_url %}
                        <a class="button-link" href="{{ assignment.web_url }}" target="_blank" rel="noreferrer">Open Assignment</a>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="muted">No assignments loaded yet.</p>
    {% endif %}
</section>
{% endblock %}